# What is Relens? [![Jenkins Status](https://jenkinsexternal.looker.com/buildStatus/icon?job=relens-master)](https://jenkins.looker.com/job/relens-master/) üçâ

This is a holding tank for the next iteration of Lens, the Looker style and component resource. This repository will likely take over looker/lens when appropriate.

Inside this repository are both the core components Lens provides and the code for a styleguide which will eventually live at lens.looker.com as an interactive resource.

# Requirements

### Yarn

[`yarn`](https://yarnpkg.com/en/) must be installed. If you don't have yarn installed, have a look at https://yarnpkg.com/en/docs/install and choose the appropriate install for your environment.

### gradle.properties

We need to connect to our private npm registry, powered by Nexus. Lens has some scripts that take care of this setup automatically, but they depend on some setup from a Helltool environment, specifically configuration of a gradle.properties file.

If you have Helltool installed and running you've likely already setup your gradle.properties file to connect to our Nexus server. [If not take a look at those directions and follow them so you can get the Nexus server user and password first](https://github.com/looker/helltool#dependencies).

# Project Scripts

Each of these scripts can be run with `yarn <command>`. They are defined in the package.json `scripts` stanza.

 * **start** starts the Styleguidist server
 * **build** builds the components and the static Styleguidist pages
 * **build-components** builds just the React components, inlining their styles
 * **build-styleguide** builds just the Styleguidist guide
 * **clean** removes the `dist` and `styleguide` directories if they exist
 * **release** runs the publishing process, distributing the package to Looker's private package repository
 * **setup** sets up the Lens environment and installs dependencies
 * **test** runs the unit tests

# Running the Styleguide

Lens is based on the [Styleguidist](https://react-styleguidist.js.org/) library. You can view its generated output by following

1. Run the commands below:
1. `git clone git@github.com:looker/relens.git`
1. `yarn setup`
1. `yarn start`
1. Open [http://localhost:6060](http://localhost:6060) in a browser

# Creating a Component

Components are stored under `src/components/`. By convention they live in their own subdirectory, named the same as the component itself. For example a Card component would expect to be found under `src/components/Card`.

## Overview

Components are written in Typescript, leveraging the React framework. They use ES6 `import` statements to include their dependencies.

> It's assumed that for now developers will run `yarn start` and have a development server running in the background while they work.

## Integrating with Styleguidist

Styleguidist has two conventions that must be followed to leverage its documentation generation functionality:

1. Each component must be defined in its own file and exported from it.
1. Each component to be documented should have a corresponding Markdown file. If there is a Card.tsx component file, there needs to be a Card.md file to generate documentation.

Styleguidist allows all Markdown syntax, and inside the js code fences, will render any JSX tags corresponding to the Lens components.

## Testing

Tests are written using the Jest testing framework, which uses a Jasmine test like syntax and supports snapshot testing. Take a look at the [Button tests](src/components/buttons/button.test.tsx) for more detail. Note, test files must end in `.test.tsx` to be discovered by the testing framework. Snapshots generated by the snapshot tests must be added to the repository to remain valid.

## Publishing

To publish:

1. Increment the version number in `package.json`
2. run `yarn release`

This will publish Lens to a private repository hosted by Looker.

# Gotchas

 * Occasionally Styleguidist seems to crash, especially when it is trying to compile invalid React code. If you suddenly start noticing your style d.ts files are no longer valid, ensure your Styleguidist server is still running.
